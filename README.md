# AnanasCC ğŸ Cç¼–è¯‘å™¨

<div style="text-align: center;">
  <img src="https://img.shields.io/badge/language-Python-blue.svg" alt="Language">
  <img src="https://img.shields.io/badge/compiler-C_to_X86-orange.svg" alt="Compiler">
  <img src="https://img.shields.io/badge/license-MIT-green.svg" alt="License">
</div>

## é¡¹ç›®ç®€ä»‹

å¹¿è¥¿å¤§å­¦2025ç¼–è¯‘åŸç†è¯¾ç¨‹è®¾è®¡ã€‚

AnanasCCï¼ˆAnanas C Compilerï¼‰æ˜¯ä¸€ä¸ªç”¨Pythonå®ç°çš„Cè¯­è¨€åˆ°X86æ±‡ç¼–çš„ç¼–è¯‘å™¨ï¼Œä½œä¸ºç¼–è¯‘åŸç†è¯¾ç¨‹è®¾è®¡é¡¹ç›®å¼€å‘ã€‚

è¯¥ç¼–è¯‘å™¨æ”¯æŒCè¯­è¨€çš„ä¸»è¦ç‰¹æ€§å’Œéƒ¨åˆ†C++ç‰¹æ€§ï¼Œèƒ½å¤Ÿå°†Cä»£ç ç¼–è¯‘ä¸ºX86æ±‡ç¼–ä»£ç ï¼Œå¹¶å¯è¿›ä¸€æ­¥ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ã€‚

## ç¼–è¯‘æµç¨‹

- **è¯æ³•åˆ†æ**ï¼šåŸºäºLarkè§£æå™¨ï¼Œå°†Cæºç è½¬æ¢ä¸ºæ ‡è®°æµ
- **è¯­æ³•åˆ†æ**ï¼šåŸºäºLarkè§£æå™¨ï¼Œæ„å»ºæŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰
- **è¯­ä¹‰åˆ†æ**ï¼šéå†ASTï¼Œè¿›è¡Œç±»å‹æ£€æŸ¥å’Œç¬¦å·è¡¨ç®¡ç†
- **ä¸­é—´ä»£ç **ï¼šéå†ASTï¼Œä¸ºèŠ‚ç‚¹ç”ŸæˆLLVM IR
- **ä»£ç ä¼˜åŒ–**ï¼šæ”¯æŒå¤šçº§ä¼˜åŒ–
- **ç›®æ ‡ä»£ç **ï¼šå°†IRè½¬æ¢ä¸ºX86æ±‡ç¼–ä»£ç ï¼ˆå¯è¿›ä¸€æ­¥å¾—åˆ°exeï¼‰

å„é˜¶æ®µå‡åˆ†ç¦»å®ç°ï¼Œé€šè¿‡ASTäº¤äº’ã€‚

## æ”¯æŒçš„C/C++ç‰¹æ€§

- åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆint, float, char, boolç­‰ï¼‰
- å˜é‡å£°æ˜ä¸åˆå§‹åŒ–
- æ§åˆ¶æµè¯­å¥ï¼ˆif-else, for, while, break, continueç­‰ï¼‰
- è¡¨è¾¾å¼è®¡ç®—ï¼ˆä¸åŒ…æ‹¬ä½è¿ç®—ï¼‰
- å‡½æ•°å®šä¹‰ä¸è°ƒç”¨
- æŒ‡é’ˆä¸æ•°ç»„
- ç»“æ„ä½“ä¸å…±ç”¨ä½“
- æšä¸¾

## é¡¹ç›®ç»“æ„

```
AnanasCC/
â”œâ”€â”€ compiler/               # æ ¸å¿ƒä»£ç 
â”‚   â”œâ”€â”€ error/              # é”™è¯¯å¤„ç†æ¨¡å—
â”‚   â”‚   â””â”€â”€ error.py        # å„ç±»ç¼–è¯‘é”™è¯¯
â”‚   â”œâ”€â”€ lexer/              # è¯æ³•åˆ†ææ¨¡å—
â”‚   â”‚   â”œâ”€â”€ lexer.py        # è¯æ³•åˆ†æå™¨å®ç°
â”‚   â”‚   â””â”€â”€ lexicon.lark    # è¯æ³•è§„åˆ™å®šä¹‰
â”‚   â”œâ”€â”€ parser/             # è¯­æ³•åˆ†ææ¨¡å—
â”‚   â”‚   â”œâ”€â”€ parser.py       # è¯­æ³•åˆ†æå™¨å®ç°
â”‚   â”‚   â””â”€â”€ syntax.lark     # è¯­æ³•è§„åˆ™å®šä¹‰
â”‚   â”œâ”€â”€ semantic/           # è¯­ä¹‰åˆ†ææ¨¡å—
â”‚   â”‚   â”œâ”€â”€ analyzer.py     # è¯­ä¹‰åˆ†æå™¨å®ç°
â”‚   â”‚   â”œâ”€â”€ symbol.py       # ç¬¦å·è¡¨ç®¡ç†
â”‚   â”‚   â””â”€â”€ type.py         # ç±»å‹ç³»ç»Ÿ
â”‚   â”œâ”€â”€ ir/                 # ä¸­é—´ä»£ç æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ generator.py    # IRç”Ÿæˆå™¨
â”‚   â”‚   â””â”€â”€ optimizer.py    # IRä¼˜åŒ–å™¨
â”‚   â”œâ”€â”€ tree/               # AST
â”‚   â”‚   â”œâ”€â”€ transformer.py  # CSTåˆ°ASTçš„è½¬æ¢
â”‚   â”‚   â””â”€â”€ tree.py         # ASTèŠ‚ç‚¹å®šä¹‰
â”‚   â”œâ”€â”€ x86/                # ç›®æ ‡ä»£ç æ¨¡å—
â”‚   â”‚   â””â”€â”€ x86.py          # IRåˆ°X86çš„è½¬æ¢
â”‚   â”œâ”€â”€ compiler.py         # ç¼–è¯‘å™¨ä¸»ç±»
â”‚   â”œâ”€â”€ __main__.py         # å‘½ä»¤è¡Œæ¥å£
â”‚   â””â”€â”€ utils.py            # å·¥å…·å‡½æ•°
â”œâ”€â”€ tests/                  # æµ‹è¯•ç”¨ä¾‹
â”‚   â”œâ”€â”€ test.c              # ç»¼åˆæµ‹è¯•ç”¨ä¾‹
â”‚   â”œâ”€â”€ task1.c             # ä»»åŠ¡1æµ‹è¯•ç”¨ä¾‹
â”‚   â”œâ”€â”€ task2.c             # ä»»åŠ¡2æµ‹è¯•ç”¨ä¾‹
â”‚   â””â”€â”€ test.py             # æµ‹è¯•è„šæœ¬
â”œâ”€â”€ output/                 # è¾“å‡ºç›®å½•
â”‚   â””â”€â”€ output.s            # ç”Ÿæˆçš„æ±‡ç¼–ä»£ç 
â”œâ”€â”€ temp/                   # ä¸­é—´æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ 01 tokens.txt       # å•è¯è¡¨
â”‚   â”œâ”€â”€ 02 action_table.txt # ACTIONè¡¨
â”‚   â”œâ”€â”€ 02 goto_table.txt   # GOTOè¡¨
â”‚   â”œâ”€â”€ 03 ast.txt          # æŠ½è±¡è¯­æ³•æ ‘
â”‚   â”œâ”€â”€ 03 cst.txt          # å…·ä½“è¯­æ³•æ ‘
â”‚   â”œâ”€â”€ 04 opt_ir.txt       # ä¼˜åŒ–IR
â”‚   â””â”€â”€ 04 org_ir.txt       # åŸå§‹IR
â”œâ”€â”€ main.c                  # Hello World
â”œâ”€â”€ main.py                 # ä¸»ç¨‹åºå…¥å£
â””â”€â”€ requirements.txt        # é¡¹ç›®ä¾èµ–
```

## å®‰è£…ä¸ä½¿ç”¨

### ä½¿ç”¨å¯æ‰§è¡Œæ–‡ä»¶

ç›´æ¥ä¸‹è½½å¹¶ä½¿ç”¨`AnanasCC.exe`ï¼Œéœ€è¦å®‰è£…LLVMï¼ˆClangï¼‰

```bash
# ç¼–è¯‘
AnanasCC.exe your_file.c

# ç¼–è¯‘å¹¶æ‰§è¡Œ
AnanasCC.exe your_file.c -e 
```

#### å‘½ä»¤è¡Œå‚æ•°

```
usage: AnanasCC [-h] [-e] input_file

ä¸€ä¸ªç®€å•çš„Cç¼–è¯‘å™¨ã€‚

positional arguments:
  input_file         è¦ç¼–è¯‘çš„Cæºæ–‡ä»¶è·¯å¾„

optional arguments:
  -h, --help         æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯å¹¶é€€å‡º
  -e, --execute      ç¼–è¯‘å®Œæˆåç«‹å³æ‰§è¡Œç¨‹åº
```

### ä»æºç è¿è¡Œ

#### å¼€å‘ç¯å¢ƒ

- Python 3.12
- Lark 1.2.2
- LLVM

#### å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

#### ä½¿ç”¨æ–¹æ³•

1. ç¼–å†™Cæºä»£ç ï¼ˆå¦‚main.cï¼‰
2. è¿è¡Œç¼–è¯‘å™¨

```bash
# ä½¿ç”¨ä¸»ç¨‹åº
python main.py

# ä½¿ç”¨æ¨¡å—
python -m compiler your_file.c -e
```

é»˜è®¤æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨ä¼šç¼–è¯‘`main.c`æ–‡ä»¶ï¼Œå¹¶åœ¨`output`ç›®å½•ä¸‹ç”Ÿæˆæ±‡ç¼–ä»£ç å’Œå¯æ‰§è¡Œæ–‡ä»¶ã€‚

## ç¤ºä¾‹

### ç®€å•çš„Hello Worldç¨‹åº

```c
int main()
{
    printf("Hello, World!\n");
    return 0;
}
```

### æ›´å¤æ‚çš„ç¤ºä¾‹

```c
int add(int a, int *b)
{
    return a + *b;
}

struct Apple
{
    char color;
    Apple* size;
    char* name;
};

enum Bool
{
    TRUE = 0,
    FALSE
};

bool test()
{
    int a = 10, d = 3;
    int* b = &a;
    *b = 20;
    int c;
    
    if (a > 20)
        c = 3;
    else if (a == 10)
        c = 2;
    else
        c = 1;

    Apple apple = {'c', nullptr, "è è"};
    apple.name = "è‹¹æœ";
    
    return c == add(a, b);
}

int main(void)
{
    Bool a;
    if (test())
        a = 1;
    else
        a = 0;
    return a;
}
```

## å¼€å‘ä¸æ‰©å±•

### æ·»åŠ æ–°çš„è¯­è¨€ç‰¹æ€§

è¦æ·»åŠ æ–°ç‰¹æ€§ï¼Œéœ€è¦è°ƒæ•´ä»¥ä¸‹ç»„ä»¶ã€‚

1. åœ¨`lexer/lexicon.lark`ä¸­æ·»åŠ æ–°çš„è¯æ³•è§„åˆ™
2. åœ¨`parser/syntax.lark`ä¸­æ·»åŠ æ–°çš„è¯­æ³•è§„åˆ™
3. åœ¨`tree/transformer.py`ä¸­æ·»åŠ ç›¸åº”çš„ASTèŠ‚ç‚¹è½¬æ¢é€»è¾‘
4. åœ¨`semantic/analyzer.py`ä¸­æ·»åŠ è¯­ä¹‰åˆ†æè§„åˆ™
5. åœ¨`ir/generator.py`ä¸­å®ç°ä¸­é—´ä»£ç ç”Ÿæˆ

### æ‰“åŒ…ä¸ºå¯æ‰§è¡Œæ–‡ä»¶

AnanasCCå·²è¢«æ‰“åŒ…ä¸ºç‹¬ç«‹çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä½¿ç”¨PyInstallerå®ç°ã€‚

å¦‚éœ€è‡ªè¡Œæ‰“åŒ…ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ã€‚

```bash
# å®‰è£…PyInstaller
pip install pyinstaller

# æ‰“åŒ…ä¸ºå•ä¸ªå¯æ‰§è¡Œæ–‡ä»¶
pyinstaller --onefile --name AnanasCC compiler/__main__.py
```

## å½“å‰é™åˆ¶

- ä¸æ”¯æŒé¢„å¤„ç†å™¨æŒ‡ä»¤
- ä¸æ”¯æŒä½è¿ç®—
- ä¸æ”¯æŒå¯å˜å‚æ•°å‡½æ•°
- ä¸æ”¯æŒå¤æ‚çš„ç±»å‹è½¬æ¢

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ã€‚è¯¦æƒ…è¯·å‚é˜…[LICENSE](LICENSE)æ–‡ä»¶ã€‚
